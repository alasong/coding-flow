#!/usr/bin/env python3
"""
ä½¿ç”¨çœŸå®APIçš„å®Œæ•´å·¥ä½œæµæ¼”ç¤º
å±•ç¤ºget_workflow_statusæ–¹æ³•åœ¨çœŸå®APIç¯å¢ƒä¸‹çš„å·¥ä½œ
"""

import os
import sys
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from workflow.requirement_workflow import RequirementAnalysisWorkflow

def demo_with_real_api():
    """ä½¿ç”¨çœŸå®APIæ¼”ç¤ºå®Œæ•´å·¥ä½œæµ"""
    print("=" * 70)
    print("éœ€æ±‚åˆ†æå·¥ä½œæµç³»ç»Ÿ - çœŸå®APIé›†æˆæ¼”ç¤º")
    print("=" * 70)
    
    # åˆ›å»ºå·¥ä½œæµå®ä¾‹
    print("\n1. åˆ›å»ºå·¥ä½œæµå®ä¾‹ï¼ˆä½¿ç”¨çœŸå®APIï¼‰...")
    workflow = RequirementAnalysisWorkflow()
    print("âœ“ å·¥ä½œæµå®ä¾‹åˆ›å»ºæˆåŠŸ")
    
    # è·å–åˆå§‹çŠ¶æ€
    print("\n2. è·å–å·¥ä½œæµåˆå§‹çŠ¶æ€...")
    initial_status = workflow.get_workflow_status()
    print(f"   ğŸ“Š å·²åˆå§‹åŒ–Agentæ•°é‡: {initial_status['agents_initialized']}")
    print(f"   ğŸ¤– Agentåˆ—è¡¨: {list(initial_status['agents_status'].keys())}")
    print(f"   ğŸ’¾ å·¥ä½œæµæ•°æ®å¤§å°: {initial_status['workflow_data_size']} å­—èŠ‚")
    
    # è¿è¡Œå¤æ‚éœ€æ±‚åˆ†æ
    print("\n3. è¿è¡Œå¤æ‚éœ€æ±‚åˆ†æï¼ˆä½¿ç”¨çœŸå®APIï¼‰...")
    complex_requirement = """
    å¼€å‘ä¸€ä¸ªä¼ä¸šçº§é¡¹ç›®ç®¡ç†ç³»ç»Ÿï¼Œéœ€è¦åŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š
    
    ğŸ¯ ç”¨æˆ·ç®¡ç†æ¨¡å—ï¼š
    - æ”¯æŒå¤šç§è§’è‰²ï¼šç®¡ç†å‘˜ã€é¡¹ç›®ç»ç†ã€å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜ã€å®¢æˆ·
    - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†
    - ä¸ªäººèµ„æ–™å’Œå·¥ä½œç©ºé—´ç®¡ç†
    
    ğŸ“‹ é¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼š
    - é¡¹ç›®åˆ›å»ºå’Œé…ç½®
    - é¡¹ç›®æˆå‘˜ç®¡ç†å’Œæƒé™åˆ†é…
    - é¡¹ç›®æ—¶é—´çº¿å’Œé‡Œç¨‹ç¢‘è®¾ç½®
    - é¡¹ç›®çŠ¶æ€è·Ÿè¸ªå’ŒæŠ¥å‘Š
    
    ğŸ“Š ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼š
    - ä»»åŠ¡åˆ›å»ºã€åˆ†é…ã€ä¼˜å…ˆçº§è®¾ç½®
    - ä»»åŠ¡çŠ¶æ€è·Ÿè¸ªï¼ˆå¾…åŠã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å…³é—­ï¼‰
    - ä»»åŠ¡ä¾èµ–å…³ç³»ç®¡ç†
    - ä»»åŠ¡æ—¶é—´ä¼°ç®—å’Œå®é™…æ—¶é—´è®°å½•
    
    ğŸ‘¥ å›¢é˜Ÿåä½œåŠŸèƒ½ï¼š
    - å®æ—¶æ¶ˆæ¯å’Œé€šçŸ¥ç³»ç»Ÿ
    - æ–‡ä»¶å…±äº«å’Œç‰ˆæœ¬æ§åˆ¶
    - è¯„è®ºå’Œè®¨è®ºåŠŸèƒ½
    - ä¼šè®®å®‰æ’å’Œè®°å½•
    
    ğŸ“ˆ æŠ¥å‘Šå’Œåˆ†æï¼š
    - é¡¹ç›®è¿›åº¦æŠ¥å‘Š
    - å›¢é˜Ÿæˆå‘˜å·¥ä½œé‡åˆ†æ
    - é¡¹ç›®é£é™©è¯†åˆ«å’Œé¢„è­¦
    - è‡ªå®šä¹‰ä»ªè¡¨æ¿
    
    ğŸ”— é›†æˆéœ€æ±‚ï¼š
    - ä¸Gitä»£ç ä»“åº“é›†æˆ
    - ä¸CI/CDå·¥å…·é›†æˆ
    - ç¬¬ä¸‰æ–¹APIæ¥å£
    - ç§»åŠ¨ç«¯åº”ç”¨æ”¯æŒ
    
    âš¡ æ€§èƒ½è¦æ±‚ï¼š
    - æ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
    - å“åº”æ—¶é—´å°äº2ç§’
    - 99.9%ç³»ç»Ÿå¯ç”¨æ€§
    - æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
    
    ğŸ” å®‰å…¨è¦æ±‚ï¼š
    - æ•°æ®åŠ å¯†å­˜å‚¨å’Œä¼ è¾“
    - å¤šå› ç´ èº«ä»½éªŒè¯
    - å®¡è®¡æ—¥å¿—å’Œåˆè§„æ€§
    - GDPRæ•°æ®ä¿æŠ¤åˆè§„
    """
    
    print("   ğŸ“ éœ€æ±‚æè¿°å·²åŠ è½½ï¼ˆè¯¦ç»†çš„ä¼ä¸šçº§é¡¹ç›®ç®¡ç†ç³»ç»Ÿéœ€æ±‚ï¼‰")
    print("   ğŸ”„ å¼€å§‹æ‰§è¡Œéœ€æ±‚åˆ†æå·¥ä½œæµ...")
    
    result = workflow.run(complex_requirement)
    
    if result['status'] == 'success':
        print("âœ… éœ€æ±‚åˆ†æå®ŒæˆæˆåŠŸï¼")
        print(f"   ğŸ“„ è¾“å‡ºæ–‡ä»¶: {result['output_file']}")
        
        # è·å–è¿è¡Œåçš„çŠ¶æ€
        print("\n4. è·å–è¿è¡Œåçš„å·¥ä½œæµçŠ¶æ€...")
        final_status = workflow.get_workflow_status()
        print(f"   ğŸ“Š å·²åˆå§‹åŒ–Agentæ•°é‡: {final_status['agents_initialized']}")
        print(f"   ğŸ’¾ å·¥ä½œæµæ•°æ®å¤§å°: {final_status['workflow_data_size']} å­—èŠ‚")
        
        # çŠ¶æ€å˜åŒ–åˆ†æ
        print("\n5. ğŸ“ˆ çŠ¶æ€å˜åŒ–åˆ†æ...")
        data_size_increase = final_status['workflow_data_size'] - initial_status['workflow_data_size']
        print(f"   å·¥ä½œæµæ•°æ®å¤§å°å¢åŠ : {data_size_increase:,} å­—èŠ‚")
        print(f"   æ•°æ®å¢é•¿ç‡: {(data_size_increase / max(initial_status['workflow_data_size'], 1) * 100):.1f}%")
        
        # å±•ç¤ºç»“æœæ‘˜è¦
        print("\n6. âœ… éœ€æ±‚åˆ†æç»“æœæ‘˜è¦...")
        if 'results' in result:
            results = result['results']
            if 'collected_requirements' in results:
                print("   âœ“ éœ€æ±‚æ”¶é›†å®Œæˆ")
                print("   âœ“ åŠŸèƒ½éœ€æ±‚å’ŒéåŠŸèƒ½éœ€æ±‚å·²è¯†åˆ«")
            if 'analysis_results' in results:
                print("   âœ“ éœ€æ±‚å¯è¡Œæ€§åˆ†æå®Œæˆ")
            if 'validation_results' in results:
                print("   âœ“ éœ€æ±‚æ­£ç¡®æ€§éªŒè¯å®Œæˆ")
            if 'requirement_document' in results:
                print("   âœ“ éœ€æ±‚æ–‡æ¡£ç”Ÿæˆå®Œæˆ")
                print("   âœ“ ä¼ä¸šçº§é¡¹ç›®ç®¡ç†ç³»ç»Ÿéœ€æ±‚æ–‡æ¡£å·²ç”Ÿæˆ")
        
        print("\n7. ğŸ¯ å…³é”®ç‰¹æ€§éªŒè¯...")
        print("   âœ“ ä½¿ç”¨çœŸå®DASHSCOPE APIè¿›è¡Œæ™ºèƒ½åˆ†æ")
        print("   âœ“ get_workflow_status()æ–¹æ³•æ­£å¸¸å·¥ä½œ")
        print("   âœ“ å¤šAgentåä½œå®Œæˆå¤æ‚éœ€æ±‚åˆ†æ")
        print("   âœ“ è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–éœ€æ±‚æ–‡æ¡£")
        print("   âœ“ æ”¯æŒä¼ä¸šçº§å¤æ‚éœ€æ±‚å¤„ç†")
        
    else:
        print(f"âŒ éœ€æ±‚åˆ†æå¤±è´¥: {result.get('error', 'æœªçŸ¥é”™è¯¯')}")
        return
    
    print("\n" + "=" * 70)
    print("ğŸ‰ æ¼”ç¤ºå®Œæˆï¼ç³»ç»Ÿå·²æˆåŠŸé›†æˆçœŸå®API")
    print("ğŸ“Š get_workflow_status()æ–¹æ³•åœ¨çœŸå®ç¯å¢ƒä¸‹å·¥ä½œæ­£å¸¸")
    print("ğŸš€ éœ€æ±‚åˆ†æå·¥ä½œæµç³»ç»Ÿå·²å‡†å¤‡å°±ç»ª")
    print("=" * 70)

if __name__ == "__main__":
    demo_with_real_api()